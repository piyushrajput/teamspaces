<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Gantt.mxml</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="mxmlCdata">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="mxmlComponent">&lt;mx:Application</span> xmlns:mx=&quot;<span class="mxmlString">http://www.adobe.com/2006/mxml</span>&quot;
    xmlns:controller=&quot;<span class="mxmlString">com.salesforce.gantt.controller.*</span>&quot;
    xmlns:view=&quot;<span class="mxmlString">com.salesforce.gantt.view.*</span>&quot;
    width=&quot;<span class="mxmlString">100%</span>&quot; height=&quot;<span class="mxmlString">100%</span>&quot; layout=&quot;<span class="mxmlString">absolute</span>&quot; backgroundColor=&quot;<span class="mxmlString">#f3f3ec</span>&quot;<span class="mxmlComponent">&gt;</span>
   
    <span class="mxmlComment">&lt;!--</span><span class="mxmlComment"> Flex-Ajax Bridge keeps track of users that log out </span><span class="mxmlComment">--&gt;</span>
    <span class="mxmlComponent">&lt;fab:FABridge</span> xmlns:fab=&quot;<span class="mxmlString">bridge.*</span>&quot; <span class="mxmlComponent">/&gt;</span>
    
    <span class="mxmlComment">&lt;!--</span><span class="mxmlComment"> Model, Controller, Services configuration </span><span class="mxmlComment">--&gt;</span>    
    <span class="mxmlComment">&lt;!--</span><span class="mxmlComment"> &lt;controller:GanttComponents id=&quot;components&quot;/&gt; </span><span class="mxmlComment">--&gt;</span>

    <span class="mxmlTag">&lt;mx:Script&gt;</span>
        <span class="asOperator">&lt;!</span><span class="asBracket">[</span>CDATA<span class="asBracket">[</span>
            <span class="asReserved">import</span> com.salesforce.gantt.model.UI;
            <span class="asReserved">import</span> com.salesforce.gantt.model.GanttState;
            <span class="asReserved">import</span> mx.controls.Alert;
            <span class="asReserved">import</span> com.salesforce.gantt.controller.Components;
            <span class="asReserved">import</span> com.salesforce.gantt.model.UI;
            <span class="asReserved">import</span> com.salesforce.gantt.model.TaskDate;
            
            <span class="asReserved">public</span> <span class="asFunction">function</span> close<span class="asBracket">()</span> <span class="asOperator">:</span> String
            <span class="asBracket">{</span>    
                <span class="asComment">//logout user
</span>                <span class="asVar">var</span> x <span class="asOperator">:</span> int <span class="asOperator">=</span> mainView.barChart.barChartCanvas.x;
                <span class="asVar">var</span> days <span class="asOperator">:</span> int <span class="asOperator">=</span> <span class="asBracket">(</span>x <span class="asOperator">/</span> UI.scale<span class="asBracket">)</span> <span class="asOperator">*</span> <span class="asBracket">(</span><span class="asOperator">-</span>1<span class="asBracket">)</span> <span class="asOperator">+</span> 1;  
                <span class="asVar">var</span> startDate <span class="asOperator">:</span> Date <span class="asOperator">=</span> Components.instance.calendar.add<span class="asBracket">(</span>TaskDate.startDate,days<span class="asBracket">)</span>;
                
                <span class="asVar">var</span> y <span class="asOperator">:</span> int <span class="asOperator">=</span> mainView.barChart.barChartCanvas.y;
                <span class="asVar">var</span> position <span class="asOperator">:</span> int <span class="asOperator">=</span> <span class="asBracket">(</span>y <span class="asOperator">/</span> 30<span class="asBracket">)</span> <span class="asOperator">*</span> <span class="asBracket">(</span><span class="asOperator">-</span>1<span class="asBracket">)</span> <span class="asOperator">+</span> 1;<span class="asComment">//va de 0 a n
</span>                <span class="asVar">var</span> scale <span class="asOperator">:</span> int <span class="asOperator">=</span> <span class="asBracket">(</span><span class="asReserved">this</span>.width <span class="asOperator">-</span> 30<span class="asBracket">)</span> <span class="asOperator">/</span> UI.scale;
                
                <span class="asVar">var</span> newGantState <span class="asOperator">:</span> GanttState <span class="asOperator">=</span> <span class="asReserved">new</span> GanttState<span class="asBracket">(</span>scale,startDate,position,Components.instance.session.user<span class="asBracket">)</span>;
                <span class="asReserved">if</span><span class="asBracket">(</span>Components.instance.ganttState <span class="asOperator">!=</span> <span class="asReserved">null</span><span class="asBracket">)</span>
                <span class="asBracket">{</span>
                    newGantState.id <span class="asOperator">=</span> Components.instance.ganttState.id;
                    Components.instance.salesforceService.ganttStateOperation.update<span class="asBracket">(</span>newGantState<span class="asBracket">)</span>;
                <span class="asBracket">}</span>
                <span class="asReserved">else</span>
                <span class="asBracket">{</span>
                    Components.instance.salesforceService.ganttStateOperation.create<span class="asBracket">(</span>newGantState<span class="asBracket">)</span>;
                <span class="asBracket">}</span>
                
                Components.instance.salesforceService.authenticateOperation.deleteAuthenticateUser<span class="asBracket">()</span>;
                
                <span class="asReserved">return</span> <span class="asString">&quot;0&quot;</span>;
            <span class="asBracket">}</span>
        <span class="asBracket">]]</span><span class="asOperator">&gt;</span>
    <span class="mxmlTag">&lt;/mx:Script&gt;</span>

    <span class="mxmlComment">&lt;!--</span><span class="mxmlComment"> Top level View </span><span class="mxmlComment">--&gt;</span>
    <span class="mxmlComponent">&lt;view:MainView</span> id=&quot;<span class="mxmlString">mainView</span>&quot; width=&quot;<span class="mxmlString">100%</span>&quot; height=&quot;<span class="mxmlString">100%</span>&quot;<span class="mxmlComponent">/&gt;</span>
    
    <span class="mxmlComment">&lt;!--</span><span class="mxmlComment">
    LEVELS: 
    ALL (0)  Designates that messages of all logging levels should be logged.
    DEBUG (2)  Logs internal Flex activities. This is most useful when debugging an application.
    INFO (4)  Logs general information.
    WARN (6)  Logs a message when the application encounters a problem. These problems do not cause the application to stop running, but could lead to further errors.
    ERROR (8)  Logs a message when a critical service is not available or a situation has occurred that restricts the use of the application.
    FATAL (1000)  Logs a message when an event occurs that results in the failure of the application.
    </span><span class="mxmlComment">--&gt;</span> 
    <span class="mxmlComponent">&lt;mx:TraceTarget</span> level=&quot;<span class="mxmlString">8</span>&quot; includeDate=&quot;<span class="mxmlString">true</span>&quot; includeTime=&quot;<span class="mxmlString">true</span>&quot; includeCategory=&quot;<span class="mxmlString">true</span>&quot; includeLevel=&quot;<span class="mxmlString">true</span>&quot;<span class="mxmlComponent">&gt;</span>
        <span class="mxmlComponent">&lt;mx:filters&gt;</span>
            <span class="mxmlComponent">&lt;mx:Array&gt;</span>
                <span class="mxmlComponent">&lt;mx:String&gt;</span><span class="mxmlCdata">*</span><span class="mxmlComponent">&lt;/mx:String&gt;</span>
            <span class="mxmlComponent">&lt;/mx:Array&gt;</span>
        <span class="mxmlComponent">&lt;/mx:filters&gt;</span>
    <span class="mxmlComponent">&lt;/mx:TraceTarget&gt;</span>    

<span class="mxmlComponent">&lt;/mx:Application&gt;</span></pre></body>
</html>
