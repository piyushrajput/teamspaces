<apex:page sidebar="false" controller="ProjectTaskDetailController" tabStyle="Team__c" >

	<!-- Ajax Toolkit SDFC -->
	<script src="/soap/ajax/11.1/connection.js" type="text/javascript"></script>

	<!-- Prototype + Scriptaculous -->
	<script type="text/javascript" src="{!URLFOR($Resource.Script_aculo_us, 'prototype.js')}"></script>
	<script type="text/javascript" src="{!URLFOR($Resource.Script_aculo_us, 'scriptaculous.js')}"></script>
	<script type="text/javascript" src="{!URLFOR($Resource.Script_aculo_us, 'effects.js')}"></script>
	<script src="{!URLFOR($Resource.TeamsResources, 'inc/js/common.js')}"></script> 
	<apex:stylesheet value="{!URLFOR($Resource.TeamsResources, 'inc/css/commonLayout.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.ProjectResources, 'inc/css/projectLayout.css')}" />	
	<apex:stylesheet value="{!URLFOR($Resource.ProjectResources, 'inc/css/projectTaskDetail.css')}" />
	<apex:stylesheet value="{!URLFOR($Resource.commonResources, 'inc/css/fonts.css')}" /> 

		<!-- Portal Support -->
	<script src="{!$Resource.portalSupport}" />

    <!-- CSS styles for Portal Integration -->
    <apex:stylesheet value="{!URLFOR($Resource.portalStyles, 'portal.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.TeamsResources, 'inc/css/headerTeams.css')}" />

	<style>
	
	.btn{
		display:none
	}
	
	.projectTaskDetail {
		overflow:hidden;
		position:relative;
	}
	
	div.breadCrumbAndButtons div.breadCrumbs  {
		width:350px;
		text-align:left;
		padding:5px;
		font-size:11px;
		margin-left:10px;
		height:26px;
		overflow:hidden;
		z-index:20;
	}
	
	div.breadCrumbAndButtons {
		height:26px;	
	}
	
	.proj_percent_complete_outline {
		overflow:hidden;
	}
	
	div#percentContainer {
		height:30px;
		overflow:hidden;
		xpadding-top:5px;
		position:relative;
		clear:both;
	}
	

	div.confirmation {
		width:300px;
		height:30px;
		background:#90C142;
		color:#FFFFFF;
		text-align:center;	
		position:absolute;
		left:50%;
		top:50%;
		margin-top:-15px;
		margin-left:-150px;
		z-index:300;
		border:2px solid #004F6D;
	}
	
	
	div.projectTaskDetail table { 
		width:48%;
	}
	
	
	.assignedToTable {
		width: 100% !important;
		border: 0px !important;
	}
	
	.assignedToTable td {
		margin: 0px !important;
		padding: 0px !important;
		padding-right: 0px !important;
		width: auto !important;
		font-weight: normal !important;
	}
	
	.assignedToTable .percent {
		width: 37px !important;
		text-align: right !important;
	}
	
	.pbHeader{
		display:none;
	}
		
	</style>
	
	<script>
	var isProjectTaskList = false;
	
	function completed() {

	
		var track = $('completedTrack');
		var percentComplete = $('completedPercent');
		new PeriodicalExecuter(
			function(pe){					
				trackDim = track.getDimensions();
				percentDim = percentComplete.getDimensions();						
				if(percentDim.width < trackDim.width){							
					percentComplete.style.width = (percentDim.width + 2) + 'px';							
				} else {
									
					pe.stop();
				}		
			}, 0.02);
		
					
		var percent = $('completedPercentNumber');
		var blackbuttons = $$('.blackbutton');
		
		
		var formsTM = $$('.quickMilestoneForm');
		for(var j = 0; j < formsTM.length ; j++){
			formsTM[j].style.display = 'none';
		}
		
		for(var i = 0; i < blackbuttons.length ; i++){
			if(blackbuttons[i].className == 'blackbutton completeButton'){
				blackbuttons[i].style.display = 'none';
			}
		}
		
		var buttonContainers = $$('.buttons');

		for(var i = 0; i < buttonContainers.length ; i++){
			buttonContainers[i].style.width = '150px';			
		}
		
		
		Effect.Appear('confirmation', {duration: 0.2,
			afterFinish:function(){	
				if(!Prototype.Browser.IE){		
					setTimeout('Effect.DropOut(\'confirmation\');Effect.Fade(\'confirmation\',{duration: 0.4});', 2000);
				} else {
					setTimeout('Effect.Fade(\'confirmation\',{duration: 0.4});', 2000);
				}
			}
		});
		percent.innerHTML = '100%';
	}
	
		
		/**
		* Get URL param
		*@return string param
		*@param string param
		*/
		function getURLParam(strParamName){
		  var strReturn = "";
		  var strHref = window.location.href;
		  if ( strHref.indexOf("?") > -1 ){
		    var strQueryString = strHref.substr(strHref.indexOf("?"));
		    var aQueryString = strQueryString.split("&");
		    for ( var iParam = 0; iParam < aQueryString.length; iParam++ ){
		      if (aQueryString[iParam].indexOf(strParamName + "=") > -1 ){
		        var aParam = aQueryString[iParam].split("=");
		        strReturn = aParam[1];
		        break;
		      }
		    }
		  }
		  return unescape(strReturn);
		}
		
		var currentTeam = '{!Task.TeamId}';	
	</script>

	<div class="confirmation" id="confirmation" style="display:none;">
   		This task has been marked complete
    </div>

	
	<!-- Delete Task Overlay -->
	<c:ProjectDeleteTaskOverlay />
	
	<!-- Header -->
	<div class="header_portal" id="headerProject">
        <!-- Page Section -->
        <div class="page_section">
            <div>
                <h1 class="arial_black">{!$ObjectType.Team__c.label}</h1>
                <h2 class="arial_black">Tasks</h2>
            </div>      
        </div>      
		<div class="searchBox">
			<div>
				<div>
					<div class="center_gray">
						<form method="get" action="/apex/TeamSearchResult" onsubmit="return checkSearchLength();">
							<div class="search_box_input f_left">
								<div class="legend_portal">
									<img class="f_left" alt="" src="{!URLFOR($Resource.TeamsResources, 'images/layout/magnifier.gif')}" />
									<span>Find {!$ObjectType.Team__c.labelPlural}  </span>
								</div>
								<input type="text" value="Enter keyword or name" name="key" onfocus="setValue('');"  onblur="if(getValue(this)==''){ setValue('Enter keyword or name'); }"/>
							</div>
							<input type="submit" value="Search" class="search_btn f_left"/>
						</form>
					</div>
				</div>
			</div>
		</div> 
		<div class="help">
			<div>
				<a href="javascript:;">Help for this page</a>  <img src="{!URLFOR($Resource.TeamsResources, 'images/layout/help_icon.gif')}" alt="" />
			</div>
		</div> 
		<div class="gray_border"></div>
	</div>
    <!-- Main Content Div -->
    <div class="main_content_projectList"> 
    	<!-- BreadCrumb and buttons -->     
        <div align="center" class="breadCrumbAndButtons">
          <div class="breadCrumbs">
          	<a  href="/apex/TeamsRedirect?id={!Task.TeamId}">{!Task.TeamName} Home</a> > <a  href="/apex/projectTasklist?id={!Task.TeamId}">Tasks</a> > {!Task.Name}
          </div>
          <div class="buttons" style="{!IF(Task.IsTaskOwner,'width:262px;','')}">
	        	<apex:outputpanel rendered="{!OR(userPermissions.canManage,Task.IsTaskOwner)}" layout="block">
		        	<a class="blackbutton" href="TeamsCreateNewTask?id={!Task.TeamId}&task={!Task.id}">
		        		<span>Edit Task</span>
		        	</a>
		        		
		
		        	<apex:form id="quickMilestoneForm" styleclass="quickMilestoneForm" onsubmit="if(isCompleted){alert('The task percent is already completed.');return false}"  >	
						<apex:actionStatus id="taskStatus">
						<apex:facet name="start">
							 <a class="blackbutton" href="Javascript:;" >
					        	<span>Mark Complete...</span>
					        </a>
						</apex:facet>
	                	<apex:facet name="stop">	
	                		<apex:outputPanel id="TaskPanel">		
								<apex:commandLink action="{!markComplete}" 										 										
									rerender="TaskPanel"
									status="taskStatus"
									styleClass="blackbutton completeButton" 
									oncomplete="completed();">
									<span>Mark Complete</span>
										</apex:commandLink>
								</apex:outputPanel>
							</apex:facet>
						</apex:actionStatus>
					</apex:form>		        	
			        <a class="blackbutton" href="Javascript:;" onclick="showDeleteEvent('{!Task.id}', true, {!Task.Milestone});">
			        	<span>Delete</span>
			        </a>		        	
		        </apex:outputpanel>
          </div>
        </div>       
        <!-- Holder -->      
        <div class="holder" style="overflow:hidden;clear:both;">
        	        
        	<apex:outputpanel rendered="{!IF(!detailsOk,true,false)}"  layout="block">
        		<p>No Id given , no id to look for</p>
        	</apex:outputpanel>
        	 
			<apex:outputpanel styleClass="projectTaskDetail" rendered="{!detailsOk}" layout="block" style="overflow:hidden;position:relative;clear:both;" >
				<apex:detail relatedList="false"  title="false">			
				</apex:detail>	
				<div class="bPageBlock">

				<table class="detailList">
					<tbody>
						<tr>
							<td class="labelCol">
								Status
							</td>
							<td class="dataCol">
								<span class="taskStatus" style="display:none;" id="">In Progress</span>
								<span class="taskPercent" id="completedPercentNumber">{!Task.PercentCompleted}%</span>
								<div class="proj_percent_complete_outline" id="completedTrack">
			                    	<div class="proj_percent_complete_value" style="width: {!Task.PercentCompleted}%;" id="completedPercent"></div>
			                    	<script>var isCompleted = {!IF(Task.PercentCompleted == 100, true, false)};</script>
			                	</div>
							</td>
							<td class="labelCol">
								Parent Task
							</td>
							<td class="dataCol">
								<span class="textDisabled" >
									{!IF((Task.ParentTaskName == ''),'none','')}
								</span>
									{!Task.ParentTaskName}
							</td>			
						</tr>			 
						<tr >
							<td class="labelCol vTop">Files</td>
							<td class="dataCol">
								<apex:repeat value="{!Task.Files}" var="item" >
										<img style="vertical-align:bottom;" src="{!URLFOR($Resource.FileTypeIcons, item.attachImage)}"/> &nbsp;
										<a href="javascript:;" onclick="window.open('/servlet/servlet.FileDownload?file={!item.Id}')" >{!item.Name}</a><br>
								</apex:repeat>							
							</td>			
						</tr>
						<tr>
							<td class="labelCol vTop">
	                              Assigned To
	                      	</td>
	                      <td class="dataCol">
	                          <apex:outputpanel rendered="{!Task.HasAsignee}" >
	                              <table class="assignedToTable">
	                                  <apex:repeat value="{!Task.Asignee}" var="item">
	                                      <tr>
	                                          <td><a href="PeopleProfileDisplay?id={!item.Id}">{!item.Name}</a></td>
	                                          <td class="percent">{!item.percent}%</td>
	                                      </tr>                                     </apex:repeat>
	                              </table>
	                          </apex:outputpanel>
	                          <apex:outputpanel rendered="{!IF(!Task.HasAsignee,true,false)}" >
	                              Nobody Asigned to this task.
	                          </apex:outputpanel>
	                      </td>
	                   </tr>
					</tbody>					
				</table>
				</div><br style="clear:both;" />				
			</apex:outputpanel>
			<br style="clear:both;" />
		</div>
        <div align="center" class="breadCrumbAndButtons">

                    
          <div class="buttons" style="{!IF(Task.IsTaskOwner,'width:262px;','')}">
                    
	        	<apex:outputpanel rendered="{!OR(userPermissions.canManage,Task.IsTaskOwner)}" layout="block">
		        	<a class="blackbutton" href="TeamsCreateNewTask?id={!Task.TeamId}&task={!Task.id}">
		        		<span>Edit Task</span>
		        	</a>
			        <apex:form id="quickMilestoneForm2" styleclass="quickMilestoneForm" onsubmit="if(isCompleted){alert('The task percent is already completed.');return false}" >	
						<apex:actionStatus id="taskStatus2">
						<apex:facet name="start">
							 <a class="blackbutton" href="Javascript:;" >
					        	<span>Mark Complete...</span>
					        </a>
						</apex:facet>
	                	<apex:facet name="stop">	
	                		<apex:outputPanel id="TaskPanel2">		
								<apex:commandLink action="{!markComplete}" 										 										
									rerender="TaskPanel2"
									status="taskStatus2"
									styleClass="blackbutton completeButton" 
									oncomplete="completed();">
									<span>Mark Complete</span>
										</apex:commandLink>
								</apex:outputPanel>
							</apex:facet>
						</apex:actionStatus>
					</apex:form>		   
			       	<a class="blackbutton" href="Javascript:;" onclick="showDeleteEvent('{!Task.id}', false, {!Task.Milestone});">
			       		<span>Delete</span>
			       	</a>		     
		        </apex:outputpanel>
          </div>
        </div>      		
	</div>   
	<style>
		.bPageBlock, .pbBody {
			border: 0pt!important;
			background: #fff!important;
			padding: 0pt!important;  
			margin-bottom: 0pt!important;
		}
		.bPageBlock .detailList .col02, .bPageBlock .detailList td  {
			border: none!important;
		}
		.bPageBlock .labelCol {
			color: #666!important;
			font-size: 12px!important;
		}
		.bPageBlock .dataCol, .bPageBlock  .labelCol {
			padding:4px 2px 4px 18px!important;
			
		}
	</style>
	<script>
		readPortalCSSRules();
		function clearTableDetail()
		{
			 $$('.pbBottomButtons')[0].hide();
			 $$('.pbHeader')[0].hide();
			 $$('.pbFooter')[0].hide();

		}
		clearTableDetail();
	</script>
</apex:page>